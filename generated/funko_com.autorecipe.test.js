import { expect, test, describe } from "bun:test";
import { runEngine, findEntry, loadEnvVariables } from '../Engine/utils/test_utils.js';

// Auto-generated by autoRecipe.js
await loadEnvVariables();
const TIMEOUT = parseInt(process.env.TEST_TIMEOUT);

const RECIPE = "funko_com.json";
const INPUT = {
    AUTOCOMPLETE: "test",
    URL: "https://funko.com/pop-wendy-testaburger/86308.html"
};

const ENTRY = {"TITLE":"Pop! Wendy Testaburger","SUBTITLE":"$14.99"};

describe(RECIPE, () => {
    test("--type autocomplete", async () => {
        const results = await runEngine(`generic/${RECIPE}`, "autocomplete", INPUT.AUTOCOMPLETE);
        
        // Validate we got multiple results (not just 1)
        expect(results.results).toBeDefined();
        expect(Array.isArray(results.results)).toBe(true);
        expect(results.results.length).toBeGreaterThanOrEqual(2);
        
        const entry = findEntry(results, ENTRY.TITLE, ENTRY.SUBTITLE);

        expect(entry.TITLE).toBe(ENTRY.TITLE);
        expect(entry.SUBTITLE).toBe(ENTRY.SUBTITLE);
        expect(entry.URL).toBeDefined();
        expect(entry.COVER).toBeDefined();
    }, TIMEOUT);

    test("--type url", async () => {
        const result = await runEngine(`generic/${RECIPE}`, "url", INPUT.URL);

        expect(result.TITLE).toBeDefined();
        expect(result.DESCRIPTION).toBeDefined();
        expect(result.COVER).toBeDefined();
    }, TIMEOUT);
});
